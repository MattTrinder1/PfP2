parameters:
- name: canvasApp
  type: string
- name: solutionprefix
  type: string
- name: minorversion
  type: string
- name: releaseversion
  type: string
- name: connectionString
  type: string
- name: customername
  type: string
- name: environmentname
  type: string

steps:
- checkout: none

- task: MSCRMToolInstaller@12
  inputs:
    nugetFeed: 'official'
    psFeed: 'official'   
    
- template: get-solution-filenames.yml
  parameters:
    pipelineworkspace : $(pipeline.workspace)\CumbriaBuild-Managed-CanvasApps${{parameters.canvasApp}}
    minorversion : ${{parameters.minorversion}}
    releaseversion : ${{parameters.releaseversion}}
    solutionprefix : ${{parameters.solutionprefix}}
    customername : ${{parameters.customername}}
    environmentname : ${{parameters.environmentname}}

- template: install-managed-solution.yml
  parameters:
    pipelineworkspace : $(pipeline.workspace)\CumbriaBuild-Managed-CanvasApps${{parameters.canvasApp}}
    connectionstring : ${{parameters.connectionString}}
    SolutionFileName : $(CanvasApps${{parameters.canvasApp}}SolutionFileName)
