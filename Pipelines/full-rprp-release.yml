#parameters:
#- name: prefix
#  type: string
#  default: 
#  values:
#  - CP
#  - RP
#- name: solutionName
#  type: string
#  default: 
#  values:
#  - WebResources
#  - OptionSets
#  - Entities
#  - SecurityRoles
#  - Processes
#  - Plugins
#  - PluginSteps
#  - Dashboards
#  - ModelDrivenApps
  
trigger: none

pool:
  name: MOD Pool

variables:
- name: minor.version
  value: 0
- name: release.version
  value: 0 
- name: solution.prefix
  value: "RP"
- template: connectionStrings.yml

name: $(Build.DefinitionName) - $(Build.BuildId) 

stages: 
#----------------------------------Start Stage-------------------------------------------------------------------
  - stage: AssembleRelease
    jobs:
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Start Job~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    - job: Assemble
      steps:
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "WebResources"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "OptionSets"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "Entities"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "SecurityRoles"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "Plugins"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "PluginSteps"
          publish : "no"
      - template: assembleReleaseForBaseSolution.yml
        parameters:
          managed: Managed
          minorversion : $(minor.version)
          releaseversion : $(release.version)
          solutionprefix : "RP"
          appFolderName : "ModelDrivenApps"
          publish : "no"
      - publish: '$(build.binariesdirectory)/RPRP'
        artifact: CumbriaBuild-Managed-RPRP

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~End Job~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#----------------------------------End Stage-------------------------------------------------------------------
