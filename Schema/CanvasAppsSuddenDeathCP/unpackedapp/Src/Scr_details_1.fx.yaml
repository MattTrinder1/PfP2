"Scr_details_1 As screen.'phoneLayout_FluidGridWithHeaderPageLayout_ver3.0'":
    OnHidden: =Reset(drpAddPersonTitle);
    OnVisible: |-
        =Set(gblErrorLog,0);
        Set(
            addcontactmethod,
            false
        );
        Set(errormessage,false);
        UpdateContext({addcontactmethod: false});
        Set(
            contactworkphone,
            false
        );
        UpdateContext({contactworkphone: false});
        Set(
            contactmail,
            false
        );
        UpdateContext({contactmail: false});
        Set(
            contacthomephone,
            false
        );
        UpdateContext({contacthomephone: false});
        Set(
            contactmobile,
            false
        );
        UpdateContext({contactmobile: false});
        Set(
            occupation,
            false
        );
        UpdateContext({occupation: false});
        Set(
            ydetails,
            0
        );
        
        
        Set(
            y1details,
            0
        );
        Set(
            madcol,
            LightGoldenRodYellow
        );
        UpdateContext({madcol: LightGoldenRodYellow});
        Set(
            madcolA,
            LightGoldenRodYellow
        );
        UpdateContext({madcolA: LightGoldenRodYellow});
        Set(
            madcolB,
            LightGoldenRodYellow
        );
        UpdateContext({madcolB: LightGoldenRodYellow});
        Set(
            madcolC,
            LightGoldenRodYellow
        );
        UpdateContext({madcolC: LightGoldenRodYellow});
        Set(
            madcolD,
            LightGoldenRodYellow
        );
        UpdateContext({madcolD: LightGoldenRodYellow});
        Set(
            madcolE,
            LightGoldenRodYellow
        );
        UpdateContext({madcolE: LightGoldenRodYellow});
        Set(
            madcolF,
            LightGoldenRodYellow
        );
        UpdateContext({madcolF: LightGoldenRodYellow});
        Set(
            madcolF,
            LightGoldenRodYellow
        );
        UpdateContext({madcolF: LightGoldenRodYellow});
        Set(
            madcolG,
            LightGoldenRodYellow
        );
        UpdateContext({madcolG: LightGoldenRodYellow});
        Set(
            madcolH,
            LightGoldenRodYellow
        );
        UpdateContext({madcolH: LightGoldenRodYellow});
        Set(
            madcolI,
            LightGoldenRodYellow
        );
        UpdateContext({madcolI: LightGoldenRodYellow});
        Set(
            madcolJ,
            LightGoldenRodYellow
        );
        UpdateContext({madcolJ: LightGoldenRodYellow});
        Set(
            madcolK,
            LightGoldenRodYellow
        );
        UpdateContext({madcolK: LightGoldenRodYellow});
        Set(
            madcolL,
            LightGoldenRodYellow
        );
        UpdateContext({madcolL: LightGoldenRodYellow});
        Set(
            madcolM,
            LightGoldenRodYellow
        );
        UpdateContext({madcolM: LightGoldenRodYellow});
        Set(
            madcolM,
            LightGoldenRodYellow
        );
        UpdateContext({madcolM: LightGoldenRodYellow});
        Set(
            madcolN,
            LightGoldenRodYellow
        );
        UpdateContext({madcolN: LightGoldenRodYellow});
        Set(
            madcolO,
            LightGoldenRodYellow
        );
        Set(
            madcolEFG,
            LightGoldenRodYellow
        );
        UpdateContext({madcolEFG: LightGoldenRodYellow});
        If(Len(Txt_person_occupation_details.Text)>0,UpdateContext({madcolK:White}),UpdateContext({madcolk:LightGoldenRodYellow}));
        If(Len(Text(cboAddPersonCountry.Selected.cp_name))>0,UpdateContext({madcolK:White}),UpdateContext({madcolK:LightGoldenRodYellow}));
        UpdateContext({madcolO: LightGoldenRodYellow});
        Reset(drpAddPersonTitle);
        Reset(txtAddPersonForename);
        Reset(tstAddPersonSurname);
        Reset(dtpAddPersonDOB);
        Reset(txtAddPersonHouseName);
        Reset(txtAddPersonHouseNumber);
        Reset(txtAddPersonStreet);
        Reset(txtAddPersonDistrict);
        Reset(txtAddPersonTown);
        Reset(txtAddPersonCountry);
        Reset(txtAddPersonPostCode);
        Reset(cboAddPersonCountry);
        Reset(txtAddPersonHomePhone);
        Reset(txtAddPersonWorkPhone);
        Reset(txtAddPersonMobilePhone);
        Reset(txtAddPersonEmail);
        Reset(drpAddPersonContactMethod);
        Reset(radAddPersonRetired);
        Reset(txtAddPersonAdditionalInfo);
        Reset(txtAddPersonHowLongKnown);
        Reset(txtAddPersonRelationship);
        Reset(cboAddPersonRole);
        Reset(Txt_person_occupation_details);
        If(
            Find(
                "Identifier",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                ident,
                "Identifier"
            )
        );
        If(
            Find(
                "Identifier",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                ident,
                ""
            )
        );
        If(
            Find(
                "Spouse",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                spous,
                "Spouse"
            )
        );
        If(
            Find(
                "Spouse",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                spous,
                ""
            )
        );
        If(
            Find(
                "Next of Kin",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                nok,
                "Next of Kin"
            )
        );
        If(
            Find(
                "Next of Kin",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                nok,
                ""
            )
        );
        If(
            Find(
                "Other",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                other,
                "Other"
            )
        );
        If(
            Find(
                "Other",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                other,
                ""
            )
        );
        If(
            Find(
                "Last Seen Alive By",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                lsab,
                "Last Seen Alive By"
            )
        );
        If(
            Find(
                "Last Seen Alive By",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                lsab,
                ""
            )
        );
        If(
            Find(
                "Parent/Guardian",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                pg,
                "Parent/Guardian"
            )
        );
        If(
            Find(
                "Parent/Guardian",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                pg,
                ""
            )
        );
        If(
            Find(
                "Second point of contact",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) > 0,
            Set(
                spoc,
                "Second point of contact"
            )
        );
        If(
            Find(
                "Second point of contact",
                LookUp(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ).Contactrolename
            ) = Blank(),
            Set(
                spoc,
                ""
            )
        );
        Set(
            fillhomeph1,
            White
        );
        Set(
            fillmobileph1,
            White
        );
        Set(
            fillworkph1,
            White
        );
        Set(
            validstart1,
            true
        );

    RectQuickActionBar_header_1 As rectangle:
        Height: =88
        Width: =Parent.Width
        ZIndex: =2

    Lbl_header_details_1 As label:
        Align: =Align.Center
        Fill: =RGBA(153, 153, 153, 1)
        FontWeight: =FontWeight.Bold
        Height: =88
        Size: =27
        Text: ="Add a person" 
        Width: =Parent.Width
        ZIndex: =3

    Canvas_details_1 As fluidGrid.fluidGridWithBlankCard:
        BorderThickness: =0
        Height: =939
        Width: =Parent.Width
        Y: =RectQuickActionBar_header_1.Y + RectQuickActionBar_header_1.Height
        ZIndex: =4

        DataCard_details_scroll_1 As dataCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =0
            DisplayMode: =DisplayMode.Edit
            Fill: =White
            Height: =2442
            Width: =Parent.Width
            X: =0
            Y: =0
            ZIndex: =1

            Drpdn_incident_key_5 As dropdown:
                BorderColor: =RGBA(128, 128, 128, 1)
                ChevronBackground: =RGBA(128, 128, 128, 1)
                ChevronHoverBackground: =ColorFade(RGBA(230, 230, 230, 100), -20%)
                Default: =LookUp('Sudden death offline',Key=Sudden_Primary_key).Key
                DisabledColor: =RGBA(128, 128, 128, 1)
                DisplayMode: =DisplayMode.Disabled
                Height: =70
                HoverFill: =RGBA(230, 230, 230, 1)
                Items: =Filter('Sudden death offline',Key=Sudden_Primary_key).Key
                SelectionFill: =RGBA(128, 128, 128, 1)
                Size: =21
                Width: =545
                X: =40
                Y: =32
                ZIndex: =1

            drpAddPersonTitle As dropdown:
                AllowEmptySelection: =true
                BorderColor: =RGBA(128, 128, 128, 1)
                ChevronBackground: =RGBA(128, 128, 128, 1)
                ChevronHoverBackground: =ColorFade(RGBA(230, 230, 230, 100), -20%)
                Default: =""
                Fill: =madcolO
                Height: =70
                HoverFill: =RGBA(230, 230, 230, 1)
                Items: =StaffTitleoffline
                OnChange: |-
                    =If(Len(drpAddPersonTitle.Selected.cp_name)>0,UpdateContext({madcolO:White}),UpdateContext({madcolO:LightGoldenRodYellow}))
                OnSelect: |-
                    =If(Len(drpAddPersonTitle.Selected.cp_name)>0,UpdateContext({madcolO:White}),UpdateContext({madcolO:LightGoldenRodYellow}))
                PressedFill: =RGBA(230, 230, 230, 1)
                SelectionFill: =RGBA(128, 128, 128, 1)
                Size: =21
                Width: =545
                X: =40
                Y: =277
                ZIndex: =2

            txtAddPersonForename As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Clear: =true
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: =
                Size: =21
                Width: =545
                X: =40
                Y: =393
                ZIndex: =3

            tstAddPersonSurname As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Clear: =true
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: =
                OnSelect: |-
                    =If(
                        Len(tstAddPersonSurname.Text) > 0,
                        UpdateContext({madcolA: Transparent}),
                        UpdateContext({madcolA: LightGoldenRodYellow})
                    );
                Size: =21
                Width: =545
                X: =40
                Y: =516
                ZIndex: =4

            dtpAddPersonDOB As datepicker:
                BorderColor: =RGBA(153, 153, 153, 1)
                DefaultDate: =""
                Fill: =If(!IsBlank(Self.SelectedDate) And Self.SelectedDate > Date(1900,1,1) And Self.SelectedDate < Date(2050,12,31) ,White,LightGoldenRodYellow)
                Height: =70
                IconBackground: =RGBA(128, 128, 128, 100)
                InputTextPlaceholder: ="DD/MM/YYYY"    
                IsEditable: =true
                OnChange: |-
                    =If (dtpAddPersonDOB.SelectedDate >0,UpdateContext({madcolD:Transparent}),UpdateContext({madcolD:LightGoldenRodYellow}))
                OnSelect: |-
                    =If(IsBlank(dtpAddPersonDOB),
                        UpdateContext({madcolD: LightGoldenRodYellow}),
                        UpdateContext({madcolD: Transparent })
                    );
                    
                    //remember to change madcol
                Size: =24
                StartYear: =1900
                Width: =545
                X: =40
                Y: =635
                ZIndex: =5

            Label_dob_11 As label:
                Height: =70
                Size: =21
                Text: ="Date of birth"
                Width: =545
                X: =40
                Y: =581
                ZIndex: =6

            txtAddPersonHouseName As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: =
                Size: =21
                Width: =545
                X: =40
                Y: =759
                ZIndex: =7

            txtAddPersonHouseNumber As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =Transparent
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: |-
                    =If(
                        Len(txtAddPersonHouseNumber.Text) > 0,
                        UpdateContext({madcolC: Transparent}),
                        UpdateContext({madcolC: LightGoldenRodYellow})
                    );
                OnSelect: =
                Size: =21
                Width: =545
                X: =40
                Y: =875
                ZIndex: =8

            txtAddPersonStreet As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: |-
                    =If(
                        Len(txtAddPersonStreet.Text) > 0,
                        UpdateContext({madcolE: Transparent}),
                        UpdateContext({madcolE: LightGoldenRodYellow})
                    );
                OnSelect: |-
                    =If(
                        Len(txtAddPersonStreet.Text)>0,
                        UpdateContext({madcolE: Transparent}),
                        UpdateContext({madcolE: LightGoldenRodYellow})
                    );
                Size: =21
                Width: =545
                X: =40
                Y: =990
                ZIndex: =9

            txtAddPersonDistrict As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: =
                OnSelect: =
                Size: =21
                Width: =545
                X: =40
                Y: =1104
                ZIndex: =10

            txtAddPersonTown As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: |
                    =If(
                        Len(txtAddPersonTown.Text) > 0,
                        UpdateContext({madcolG: Transparent}),
                        UpdateContext({madcolG: LightGoldenRodYellow})
                    );
                OnSelect: |-
                    =If(Len(txtAddPersonTown.Text)>0,UpdateContext({madcolE:Transparent}),
                    UpdateContext({madcolE:LightGoldenRodYellow}))
                Size: =21
                Width: =545
                X: =40
                Y: =1214
                ZIndex: =11

            txtAddPersonCountry As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: |
                    =If(
                        Len(txtAddPersonCountry.Text) > 0,
                        UpdateContext({madcolH: White}),
                        UpdateContext({madcolH: LightGoldenRodYellow})
                    );
                OnSelect: |-
                    =
                    
                    If(Len(txtAddPersonStreet.Text)>0,UpdateContext({madcolH:White}),
                    UpdateContext({madcolH:LightGoldenRodYellow}))
                Size: =21
                Width: =545
                X: =42
                Y: =1322
                ZIndex: =12

            txtAddPersonPostCode As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: |-
                    =If(
                        Len(txtAddPersonPostCode.Text) > 0,
                        UpdateContext({madcolI: White}),
                        UpdateContext({madcolI: LightGoldenRodYellow})
                    );
                    If(txtAddPersonPostCode.Text=Upper(txtAddPersonPostCode.Text),Green,Reset(txtAddPersonPostCode));
                OnSelect: |-
                    =If(
                        Len(txtAddPersonPostCode.Text) > 0,
                        UpdateContext({madcolI: White}),
                        UpdateContext({madcolI: LightGoldenRodYellow})
                    );
                Size: =21
                Tooltip: ="Only upper case allowed"
                Width: =545
                X: =40
                Y: =1435
                ZIndex: =13

            Lbl_address_10 As label:
                Height: =54
                Size: =21
                Text: ="House Name or House Number"
                Width: =521
                X: =40
                Y: =705
                ZIndex: =14

            Label_star_address_10 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =730
                ZIndex: =15

            Label_star_house_number_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =955
                ZIndex: =16

            Label_star_town_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =1177
                ZIndex: =17

            Label_star_county_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =567
                Y: =1285
                ZIndex: =18

            Label_star_post_code_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =1403
                ZIndex: =19

            Label_star_city_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =1512
                ZIndex: =20

            drpAddPersonContactMethod As dropdown:
                BorderColor: =RGBA(128, 128, 128, 1)
                ChevronBackground: =RGBA(128, 128, 128, 1)
                ChevronHoverBackground: =ColorFade(RGBA(230, 230, 230, 100), -20%)
                Default: =""
                Fill: =madcolL
                Height: =70
                HoverFill: =RGBA(230, 230, 230, 1)
                Items: =contactmethodoffline
                OnChange: |
                    =If(
                        Len(drpAddPersonContactMethod.Selected.cp_name)>0,
                        UpdateContext({madcolL: White}),
                        UpdateContext({madcolL: LightGoldenRodYellow})
                    );
                OnSelect: |
                    =
                PressedFill: =RGBA(230, 230, 230, 1)
                SelectionFill: =RGBA(128, 128, 128, 1)
                Size: =21
                Width: =545
                X: =40
                Y: =2336
                ZIndex: =21

            Lbl_preferedcontactmethod_2 As label:
                Height: =70
                Size: =21
                Text: ="Preferred contact method"
                Width: =475
                X: =40
                Y: =2277
                ZIndex: =22

            Label_dob_7 As label:
                Height: =70
                Size: =21
                Text: |-
                    ="Role" //& IsBlank(cboAddPersonRole.SelectedItems) &  " : " & CountRows(Filter(cboAddPersonRole.SelectedItems,!IsBlank(cp_name)))
                Width: =545
                X: =40
                Y: =94
                ZIndex: =25

            Label_dob_8 As label:
                Height: =70
                Size: =21
                Text: ="Title"
                Width: =545
                X: =40
                Y: =220
                ZIndex: =26

            Label_star_address_2 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =236
                ZIndex: =27

            Label_star_address_9 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =563
                Y: =601
                ZIndex: =28

            Label_star_address_8 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =563
                Y: =472
                ZIndex: =30

            Label_star_address_7 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =565
                Y: =359
                ZIndex: =31

            Label_dob_9 As label:
                Height: =70
                Size: =21
                Text: ="Forename"
                Width: =506
                X: =40
                Y: =334
                ZIndex: =32

            Label_dob_10 As label:
                Height: =70
                Size: =21
                Text: ="Surname"
                Width: =545
                X: =42
                Y: =452
                ZIndex: =33

            Lbl_address_11 As label:
                Height: =58
                Size: =21
                Text: ="Additional address info"
                Width: =543
                X: =42
                Y: =823
                ZIndex: =34

            Lbl_address_12 As label:
                Height: =58
                Size: =21
                Text: ="Street"
                Width: =560
                X: =42
                Y: =940
                ZIndex: =35

            Lbl_address_15 As label:
                Height: =58
                Size: =21
                Text: ="County"
                Width: =560
                X: =42
                Y: =1269
                ZIndex: =36

            Lbl_address_14 As label:
                Height: =58
                Size: =21
                Text: ="Town"
                Width: =560
                X: =42
                Y: =1161
                ZIndex: =37

            Lbl_address_13 As label:
                Height: =58
                Size: =21
                Text: ="District"
                Width: =560
                X: =42
                Y: =1054
                ZIndex: =38

            Lbl_address_16 As label:
                Height: =58
                Size: =21
                Text: ="Post Code (Capitals only)"
                Width: =504
                X: =42
                Y: =1385
                ZIndex: =39

            Lbl_address_17 As label:
                Height: =58
                Size: =21
                Text: ="Country"
                Width: =560
                X: =40
                Y: =1506
                ZIndex: =40

            cboAddPersonRole As combobox:
                BorderColor: =RGBA(153, 153, 153, 1)
                ChevronBackground: =RGBA(153, 153, 153, 1)
                ChevronHoverBackground: =ColorFade(Self.BorderColor, 15%)
                DefaultSelectedItems: =
                DisplayFields: =["cp_name"]
                Fill: =madcolEFG
                Height: =70
                HoverFill: =RGBA(230, 230, 230, 1)
                IsSearchable: =false
                Items: |-
                    =Filter(
                        Filter(
                            ContactRoleoffline,
                            !(cp_name in ShowColumns(
                                Filter(
                                    UsedContactRoles,
                                    Key = Sudden_Primary_key
                                ),
                                "Role"
                            ))
                        ),
                        cp_name <> "Deceased"
                    )
                OnChange: |-
                    =/*If(
                        CountRows(excludedroles) > 0,
                        If(
                            LookUp(
                                excludedroles,
                                key = Drpdn_incident_key_5.Selected.Key
                            ).key = Drpdn_incident_key_5.Selected.Key,
                           Collect(
                                excludedroles,
                                {cp_name: cboAddPersonRole.Selected.cp_name,key : Drpdn_incident_key_5.Selected.Key}
                            ));
                            If(
                            LookUp(
                                excludedroles,
                                key = Drpdn_incident_key_5.Selected.Key
                            ).key <> Drpdn_incident_key_5.Selected.Key,
                           Collect(
                                excludedroles,
                                {cp_name: cboAddPersonRole.Selected.cp_name,key : Drpdn_incident_key_5.Selected.Key}
                            ));
                    
                    );
                    If(
                        CountRows( excludedroles) = 0,
                        ClearCollect(
                            selectededroles,
                            cboAddPersonRole.SelectedItems
                        );
                        ClearCollect(
                            excludedroles,
                            AddColumns(
                                selectededroles,
                                "key",
                                Drpdn_incident_key_5.Selected.Key
                            )
                        )
                    );
                    */
                    If(Len(cboAddPersonRole.Selected.cp_name)>0,UpdateContext({madcolEFG:White}),UpdateContext({madcolEFG:LightGoldenRodYellow}))
                OnSelect: |-
                    =If(Len(cboAddPersonRole.Selected.cp_name)>0,UpdateContext({madcolEFG:White}),UpdateContext({madcolEFG:LightGoldenRodYellow}))
                PressedFill: =RGBA(230, 230, 230, 1)
                SearchFields: =["cp_name"]
                SearchItems: =[]
                SelectionFill: =RGBA(153, 153, 153, 1)
                Size: =21
                Width: =545
                X: =40
                Y: =150
                ZIndex: =41

            cboAddPersonCountry As combobox:
                BorderColor: =RGBA(153, 153, 153, 1)
                ChevronBackground: =RGBA(153, 153, 153, 1)
                ChevronHoverBackground: =ColorFade(Self.BorderColor, 15%)
                DisplayFields: =["cp_name"]
                Fill: =If(CountRows(Self.SelectedItems) = 0 Or IsBlank(Self.Selected.cp_name) ,LightGoldenRodYellow,White)
                Height: =70
                HoverFill: =RGBA(230, 230, 230, 1)
                Items: =SortByColumns(countriesoffline,"cp_displaysequenceno",Ascending,"cp_name",Descending)
                OnChange: |-
                    =If(Len(Text(cboAddPersonCountry.Selected.cp_name))>0,UpdateContext({madcolK:White}),UpdateContext({madcolK:LightGoldenRodYellow}));
                PressedFill: =RGBA(230, 230, 230, 1)
                SearchFields: =["cp_name"]
                SearchItems: =Search(SortByColumns(countriesoffline,"cp_displaysequenceno",Ascending,"cp_name",Descending),cboAddPersonCountry.SearchText,"cp_name")
                SelectionFill: =RGBA(153, 153, 153, 1)
                SelectMultiple: =false
                Size: =21
                Width: =545
                X: =40
                Y: =1563
                ZIndex: =42

            Label_star_preffered_contact_method_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =559
                Y: =2298
                ZIndex: =43

            Label_star_preffered_contact_method_2 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =564
                Y: =1658
                ZIndex: =48

            Lbl_addcontactmethod_3 As label:
                Height: =70
                Size: =21
                Text: ="Add contact method"
                Width: =535
                X: =39
                Y: =1642
                ZIndex: =49

            lblWorkPhoneValid As label:
                Height: =70
                Size: =14
                Text: ="Number may not be valid but will still submit"
                Visible: =If(IsBlank(txtAddPersonWorkPhone.Text),false,If(IsMatch(txtAddPersonWorkPhone.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),false,true))
                Width: =239
                X: =316
                Y: =1836
                ZIndex: =64

            Group2 As group:
                Height: =5
                Width: =5
                X: =60
                Y: =60
                ZIndex: =64

                rectContactMethods As rectangle:
                    BorderColor: =RGBA(153, 153, 153, 1)
                    BorderThickness: =2
                    Fill: =If(!IsBlank(txtAddPersonHomePhone.Text) Or !IsBlank(txtAddPersonWorkPhone.Text) Or !IsBlank(txtAddPersonMobilePhone.Text) Or !IsBlank(txtAddPersonEmail.Text), Transparent,LightGoldenRodYellow)
                    Height: =552
                    Width: =545
                    X: =40
                    Y: =1696
                    ZIndex: =53

                txtAddPersonHomePhone As text:
                    BorderColor: =RGBA(153, 153, 153, 1)  
                    Default: =""
                    Fill: =If(IsBlank(Self.Text),White,If(IsMatch(Self.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),LightGreen,RGBA(238,204,204,1)))
                    Height: =70
                    HintText: |-
                        ="###########"
                    MaxLength: =13
                    OnChange: =
                    OnSelect: =Set(validstart1,true)
                    Size: =21
                    VirtualKeyboardMode: =VirtualKeyboardMode.Numeric
                    Width: =490
                    X: =65
                    Y: =1768
                    ZIndex: =55

                txtAddPersonEmail As text:
                    BorderColor: =RGBA(179, 179, 179, 1)
                    Default: =""
                    Height: =70
                    HintText: =""
                    OnChange: =
                    Size: =21
                    Width: =488
                    X: =65
                    Y: =2166
                    ZIndex: =56

                txtAddPersonMobilePhone As text:
                    BorderColor: =RGBA(153, 153, 153, 1)  
                    Default: =""
                    Fill: =If(IsBlank(Self.Text),White,If(IsMatch(Self.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),LightGreen,RGBA(238,204,204,1)))
                    Height: =70
                    HintText: |-
                        ="###########"
                    MaxLength: =13
                    OnChange: =
                    Size: =21
                    Visible: =true    
                    Width: =488
                    X: =65
                    Y: =2036
                    ZIndex: =57

                txtAddPersonWorkPhone As text:
                    BorderColor: =RGBA(153, 153, 153, 1)  
                    Default: =""
                    Fill: =If(IsBlank(Self.Text),White,If(IsMatch(Self.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),LightGreen,RGBA(238,204,204,1)))
                    Height: =70
                    HintText: |-
                        ="###########"
                    MaxLength: =13
                    OnChange: =
                    Size: =21
                    Width: =488
                    X: =65
                    Y: =1901
                    ZIndex: =58

                Lbl_addcontactmethod_4 As label:
                    Height: =70
                    Size: =21
                    Text: ="Home Phone"
                    Width: =187
                    X: =65
                    Y: =1707
                    ZIndex: =59

                Lbl_addcontactmethod_5 As label:
                    Height: =70
                    Size: =21
                    Text: ="Work Phone"
                    Width: =187
                    X: =65
                    Y: =1843
                    ZIndex: =60

                Lbl_addcontactmethod_6 As label:
                    Height: =70
                    Size: =21
                    Text: ="Mobile Phone"
                    Width: =481
                    X: =65
                    Y: =1976
                    ZIndex: =61

                Lbl_addcontactmethod_7 As label:
                    Height: =70
                    Size: =21
                    Text: ="Email"
                    Width: =481
                    X: =65
                    Y: =2111
                    ZIndex: =62

                lblHomePhoneValid As label:
                    Height: =70
                    Size: =14
                    Text: ="Number may not be valid but will still submit"
                    Visible: =If(IsBlank(txtAddPersonHomePhone.Text),false,If(IsMatch(txtAddPersonHomePhone.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),false,true))
                    Width: =239
                    X: =316
                    Y: =1696
                    ZIndex: =63

            lblHomePhoneValid_1 As label:
                Height: =70
                Size: =14
                Text: ="Number may not be valid but will still submit"
                Visible: =If(IsBlank(txtAddPersonMobilePhone.Text),false,If(IsMatch(txtAddPersonMobilePhone.Text,"^[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]$"),false,true))
                Width: =238
                X: =316
                Y: =1967
                ZIndex: =65

            Label_star_address_4 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =34
                X: =559
                Y: =119
                ZIndex: =66

        DataCard2 As dataCard.blankCard:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            DisplayMode: =DisplayMode.Edit
            Fill: =RGBA(0, 0, 0, 0)
            Height: =645
            Width: =640
            X: =0
            Y: =1
            ZIndex: =2

            Label_retired_2 As label:
                Height: =66
                Size: =21
                Text: |-
                    ="Retired?
                    "
                Width: =560
                X: =40
                Y: =2
                ZIndex: =1

            radAddPersonRetired As radio:
                BorderStyle: =BorderStyle.None
                Default: =""
                Height: =97
                Items: =["Yes","No"]
                Layout: =Layout.Horizontal
                OnChange: |-
                    =UpdateContext({visibletag:true})
                OnSelect: |-
                    =If(
                        radAddPersonRetired.Selected.Value = "Yes",
                        UpdateContext({occupation: true});UpdateContext({occupation1: false}));
                        If(
                        radAddPersonRetired.Selected.Value = "No",
                        UpdateContext({occupation: false});UpdateContext({occupation1: true}));
                RadioBorderColor: =RGBA(128, 128, 128, 1)
                Size: =21
                Width: =335
                X: =40
                Y: =54
                ZIndex: =2

            txtAddPersonAdditionalInfo As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: =
                OnSelect: =
                Size: =21
                Width: =545
                X: =40
                Y: =316
                ZIndex: =3

            Label_deceased_relathionship_5 As label:
                Height: =66
                Size: =21
                Text: |-
                    ="How long known deceased?
                    "
                Width: |
                    =530
                X: =40
                Y: =379
                ZIndex: =4

            txtAddPersonHowLongKnown As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: |
                    =If(
                        Len(txtAddPersonHowLongKnown.Text) > 0,
                        UpdateContext({madcolM: White}),
                        UpdateContext({madcolM: LightGoldenRodYellow})
                    );
                OnSelect: |
                    =If(
                        Len(txtAddPersonHowLongKnown.Text)>0,
                        UpdateContext({madcolM: White}),
                        UpdateContext({madcolM: LightGoldenRodYellow})
                    );
                Size: =21
                Width: =545
                X: =40
                Y: =429
                ZIndex: =5

            Label_star_deceased_relathionship_duration_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =573
                Y: =400
                ZIndex: =7

            txtAddPersonRelationship As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =If(IsBlank(Self.Text),LightGoldenRodYellow,White)
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                OnChange: |
                    =If(
                        Len(txtAddPersonRelationship.Text) > 0,
                        UpdateContext({madcolN: Transparent}),
                        UpdateContext({madcolN: LightGoldenRodYellow})
                    );
                OnSelect: |
                    =If(
                        Len(txtAddPersonRelationship.Text) > 0,
                        UpdateContext({madcolN: Transparent}),
                        UpdateContext({madcolN: LightGoldenRodYellow})
                    );
                Size: =21
                Width: =545
                X: =40
                Y: =558
                ZIndex: =8

            Label_star_deceased_relathionship_1 As label:
                Color: =RGBA(255, 0, 0, 1)
                Height: =38
                Size: =21
                Text: ="*"
                Width: =22
                X: =570
                Y: =529
                ZIndex: =9

            Label_former_occupation_7 As label:
                Height: =70
                Size: =21
                Text: =If(radAddPersonRetired.SelectedText.Value = "Yes","Former occupation","Occupation")
                Width: =545
                X: =40
                Y: =130
                ZIndex: =10

            Label_deceased_relathionship_6 As label:
                Height: =66
                Size: =21
                Text: ="Relationship to deceased"
                Width: |
                    =530
                X: =40
                Y: =499
                ZIndex: =11

            Label_deceased_relathionship_4 As label:
                Height: =66
                Size: =21
                Text: ="Additional Information"
                Width: |
                    =530
                X: =40
                Y: =256
                ZIndex: =12

            Txt_person_occupation_details As text:
                BorderColor: =RGBA(153, 153, 153, 1)
                Default: =""
                Fill: =White
                Height: =70
                HintText: =""
                HoverBorderColor: =RGBA(128, 128, 128, 1)
                HoverFill: =RGBA(230, 230, 230, 1)
                OnChange: |-
                    =If(Len(Txt_person_occupation_details.Text)>0,UpdateContext({madcolK:White}),UpdateContext({madcolk:LightGoldenRodYellow}));
                OnSelect: |-
                    =If(Len(Txt_person_occupation_details.Text)>0,UpdateContext({madcolK:White}),UpdateContext({madcolk:LightGoldenRodYellow}));
                Reset: =Allreset
                Size: =21
                Width: =545
                X: =40
                Y: =196
                ZIndex: =14

    Icon_back_details_home_1 As icon.ArrowLeft:
        Color: =RGBA(255, 255, 255, 1)
        Icon: =Icon.ArrowLeft
        OnSelect: =Back()
        X: =31
        Y: =13
        ZIndex: =5

    Icn_exit_Home_1 As icon.Cancel:
        BorderColor: =RGBA(32, 54, 71, 1)
        Color: =RGBA(255, 255, 255, 1)
        Icon: =Icon.Cancel
        OnSelect: =Exit()
        X: =576
        Y: =13
        ZIndex: =6

    Timer3_1 As timer:
        AutoPause: =false
        AutoStart: =validstart1
        Duration: =1500
        Height: =45
        OnTimerStart: |-
            =If(
            Not(IsBlank(txtAddPersonHomePhone.Text)),
            If(
            IsMatch(
            txtAddPersonHomePhone.Text,
            "^[+]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]$"
            ),
            Set(fillhomeph1,LightGreen);Set(lockbutton1,DisplayMode.Edit);,
            Set(fillhomeph1,Red);Set(lockbutton1,DisplayMode.Disabled);
            ),
            White
            );If(
            Not(IsBlank(txtAddPersonMobilePhone.Text)),
            If(
            IsMatch(
            txtAddPersonMobilePhone.Text,
            "^[+]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]$"
            ),
            Set(fillmobileph1,LightGreen);Set(lockbutton1,DisplayMode.Edit);,
            Set(fillmobileph1,Red);Set(lockbutton1,DisplayMode.Disabled);
            ),
            White
            );If(
            Not(IsBlank(txtAddPersonWorkPhone.Text)),
            If(
            IsMatch(
            txtAddPersonWorkPhone.Text,
            "^[+]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]"&"[0-9]$"
            ),
            Set(fillworkph1,LightGreen);Set(lockbutton1,DisplayMode.Edit);,
            Set(fillworkph1,Red);Set(lockbutton1,DisplayMode.Disabled);
            ),
            White
            );
        Repeat: =true
        Visible: =false
        Width: =242
        X: =334
        Y: =472
        ZIndex: =7

    Btn_add_details_2 As button:
        DisplayMode: |-
            =If(
                And(
                    Or(
                        IsBlank(cboAddPersonRole.SelectedItems),
                        CountRows(
                            Filter(
                                cboAddPersonRole.SelectedItems,
                                !IsBlank(cp_name)
                            )
                        ) > 0
                    ),
                    !IsBlank(drpAddPersonTitle.Selected.cp_name),
                    !IsBlank(txtAddPersonForename.Text),
                    !IsBlank(tstAddPersonSurname.Text),
                    And(
                        !IsBlank(dtpAddPersonDOB.SelectedDate),
                        dtpAddPersonDOB.SelectedDate > Date(
                            1900,
                            1,
                            1
                        ),
                        dtpAddPersonDOB.SelectedDate < Date(
                            2050,
                            12,
                            31
                        )
                    ),
                    !IsBlank(txtAddPersonHouseName.Text),
                    !IsBlank(txtAddPersonStreet.Text),
                    !IsBlank(txtAddPersonTown.Text),
                    !IsBlank(txtAddPersonCountry.Text),
                    !IsBlank(txtAddPersonPostCode.Text),
                    !IsBlank(cboAddPersonCountry.Selected.cp_name),
                    !IsBlank(txtAddPersonHowLongKnown.Text),
                    !IsBlank(drpAddPersonContactMethod.Selected.cp_name),
                    !IsBlank(txtAddPersonRelationship.Text),
                    Or(
                        !IsBlank(txtAddPersonHomePhone.Text),
                        !IsBlank(txtAddPersonWorkPhone.Text),
                        !IsBlank(txtAddPersonMobilePhone.Text),
                        !IsBlank(txtAddPersonEmail.Text)
                    )
                ),
                DisplayMode.Edit,
                DisplayMode.Disabled
            )
        Fill: =RGBA(153, 153, 153, 1)
        Height: =70
        HoverFill: =ColorFade(RGBA(100, 118, 132, 1), -20%)
        OnSelect: |
            =UpdateContext({k: k + 1});
            UpdateContext({newContactKey: GUID()});
            /*If(
                And(
                    !IsBlank(cboAddPersonRole.SelectedItems.cp_name),
                    !IsBlank(drpAddPersonTitle.Selected.cp_name),
                    !IsBlank(txtAddPersonForename.Text),
                    !IsBlank(tstAddPersonSurname.Text),
                    !IsBlank(dtpAddPersonDOB.SelectedDate) ,
                    !IsBlank(txtAddPersonHouseName.Text),
                    !IsBlank(txtAddPersonStreet.Text),
                    !IsBlank(txtAddPersonTown.Text),
                    !IsBlank(txtAddPersonCountry.Text),
                    !IsBlank(txtAddPersonPostCode.Text),
                    !IsBlank(cboAddPersonCountry.Selected.cp_name),
                    !IsBlank(txtAddPersonHowLongKnown.Text),
                    !IsBlank(drpAddPersonContactMethod.Selected.cp_name),
                    !IsBlank(txtAddPersonRelationship.Text),
                    Or(
                        !IsBlank(txtAddPersonHomePhone.Text),
                        !IsBlank(txtAddPersonWorkPhone.Text),
                        !IsBlank(txtAddPersonMobilePhone.Text),
                        !IsBlank(txtAddPersonEmail.Text)
                    )
                ),
            */
            /*Set(
                gblErrorLog,
                0
            );
            Set(
                gblErrorsList,
                Blank()
            );
            //Person Roles 
            If(
                IsBlank(cboAddPersonRole.SelectedItems) Or CountRows(
                    Filter(
                        cboAddPersonRole.SelectedItems,
                        !IsBlank(cp_name)
                    )
                ) = 0,
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please select at least one person role</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Title
            If(
                IsBlank(drpAddPersonTitle.Selected.cp_name),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add Title</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Forename
            If(
                IsBlank(txtAddPersonForename.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add forename</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Surname
            If(
                IsBlank(tstAddPersonSurname.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add surname</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Date of Birth
            If(
                IsBlank(dtpAddPersonDOB.SelectedDate),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add a date of birth</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //House Name or Number
            If(
                IsBlank(txtAddPersonHouseName.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add house name or number</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Street
            If(
                IsBlank(txtAddPersonStreet.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add a street</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Town
            If(
                IsBlank(txtAddPersonTown.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add a town</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //County
            If(
                IsBlank(txtAddPersonCountry.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add a county</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Postcode
            If(
                IsBlank(txtAddPersonPostCode.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add a postcode(Capitals only)</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Country 
            If(
                IsBlank(cboAddPersonCountry.Selected.cp_name),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please select a country</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Contact Methods
            If(
                And(
                    IsBlank(txtAddPersonHomePhone.Text),
                    IsBlank(txtAddPersonWorkPhone.Text),
                    IsBlank(txtAddPersonMobilePhone.Text),
                    IsBlank(txtAddPersonEmail.Text)
                ),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>please provide at least one contact method</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //preferred contact method
            If(
                IsBlank(drpAddPersonContactMethod.Selected.cp_name),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please select a preferred contact method</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //How long have know deceased
            If(
                IsBlank(txtAddPersonHowLongKnown.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add 'How long known deceased'</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            //Relationship to deceased
            If(
                IsBlank(txtAddPersonRelationship.Text),
                Set(
                    gblErrorsList,
                    gblErrorsList & "<li>Please add 'Relationship to deceased '</li>"
                );
                Set(
                    gblErrorLog,
                    gblErrorLog + 1
                )
            );
            */
            //If(
            //    gblErrorLog = 0,
            Collect(
                Contactoffline,
                {
                    Key: Sudden_Primary_key,
                    ContactKey: newContactKey,
                    Title: drpAddPersonTitle.Selected.cp_lookupvalueid,
                    Titlename: drpAddPersonTitle.Selected.cp_name,
                    Forename: txtAddPersonForename.Text,
                    Surname: tstAddPersonSurname.Text,
                    Fullname: tstAddPersonSurname.Text & " " & txtAddPersonForename.Text,
                    'Date of Birth': dtpAddPersonDOB.SelectedDate,
                    Housename: txtAddPersonHouseName.Text,
                    Housenumber: txtAddPersonHouseNumber.Text,
                    Address1: txtAddPersonStreet.Text,
                    District: txtAddPersonDistrict.Text,
                    Town: txtAddPersonTown.Text,
                    County: txtAddPersonCountry.Text,
                    pcode: txtAddPersonPostCode.Text,
                    Country: cboAddPersonCountry.Selected.cp_name,
                    Countryid: cboAddPersonCountry.Selected.cp_lookupvalueid,
                    //electedcontactmethod:Drpdn_sel_contact_method_2.Selected.cp_lookupvalueid,
                    //Selectedcontactmethodname:Drpdn_sel_contact_method_2.Selected.cp_name,
            Homephone: txtAddPersonHomePhone.Text,
                    Workphone: txtAddPersonWorkPhone.Text,
                    Mobile: txtAddPersonMobilePhone.Text,
                    EMail: txtAddPersonEmail.Text,
                    Preferedcontactmethod: drpAddPersonContactMethod.Selected.cp_lookupvalueid,
                    Preferedcontactmethodname: drpAddPersonContactMethod.Selected.cp_name,
                    Retired: radAddPersonRetired.Selected.Value,
                    Formeroccupation: Txt_person_occupation_details.Text,
                    Formeroccupationname: Txt_person_occupation_details.Text,
                    Additionalinfo: txtAddPersonAdditionalInfo.Text,
                    Deceasedrelationshipduration: txtAddPersonHowLongKnown.Text,
                    Deceasedrelathionship: txtAddPersonRelationship.Text,
                    Gender: "",
                    Gendername: "",
                    OfficerDefinedEthnicity: "",
                    OfficerDefinedEthnicityname: "",
                    Occupation: "",
                    MaritalStatus: "",
                    DeceasedBodyLabel: "",
                    AdditionalNames: "",
                    Deceaseddetailsknown: "",
                    HasAdditionalNames: false,
                    signdate: DateTimeValue(Blank()),
                    identificationsignature: SampleImage,
                        Contactrole: Left(
                            Concat(
                                Filter(ContactRoleoffline,cp_name in cboAddPersonRole.SelectedItems.cp_name).cp_contactroletypeid,
                                cp_contactroletypeid & ","
                            ),
                            Len(
                                Concat(
                                Filter(ContactRoleoffline,cp_name in cboAddPersonRole.SelectedItems.cp_name).cp_contactroletypeid,
                                    cp_contactroletypeid & ","
                                )
                            ) - 1
                        ),
                        Contactrolename: Left(
                            Concat(
                                cboAddPersonRole.SelectedItems.cp_name,
                                cp_name & ","
                            ),
                            Len(
                                Concat(
                                    cboAddPersonRole.SelectedItems.cp_name,
                                    cp_name & ","
                                )
                            ) - 1
                        )
            ,
                    age: "",
                    placeofbirth: ""
                }
            );
            SaveData(
                Contactoffline,
                "Contactoffline"
            );
            Set(
                Allreset,
                true
            );
            UpdateIf(
                Contactoffline,
                Key = Sudden_Primary_key And ContactKey = newContactKey,
                {identificationsignature: Blank()}
            );
            //if identifier is set then set the id on the sudden death record so it know which contact to use
            If(
                !IsBlank(
                    Find(
                        "Identifier",
                        Concat(
                            cboAddPersonRole.SelectedItems.cp_name,
                            cp_name & ","
                        )
                    )
                ),
                Patch(
                    'Sudden death offline',
                    LookUp(
                        'Sudden death offline',
                        Key = Drpdn_incident_key_5.Selected.Key
                    ),
                    {IdentifierContactKey: Text(newContactKey)}
                )
            );
            Collect(
                UsedContactRoles,
                {
                    Key: Drpdn_incident_key_5.Selected.Key,
                    ContactKey:newContactKey,
                    Role: ""
                }
            );
            RemoveIf(
                UsedContactRoles,
                Key = Drpdn_incident_key_5.Selected.Key
            );
            ForAll(
                Filter(
                    Contactoffline,
                    Key = Drpdn_incident_key_5.Selected.Key
                ),
                ForAll(
                    Split(
                        ThisRecord.Contactrolename,
                        ","
                    ).Result As SplitRoles,
                    Collect(
                        UsedContactRoles,
                        {
                            Key: Drpdn_incident_key_5.Selected.Key,
                            ContactKey: ThisRecord.ContactKey,
                            Role: SplitRoles.Result
                        }
                    )
                )
            );
            
            SaveData(
                UsedContactRoles,
                "UsedContactRoles"
            );
            SaveData(
                'Sudden death offline',
                "Sudden death offline"
            );
            Navigate(
                Scr_home,
                UnCoverRight
            );
            /*,Set(errormessage,true);)*/
            //);
        Size: =24
        Text: ="Add into person summary"
        Width: =545
        X: =47
        Y: =1061
        ZIndex: =8

    Label10 As label:
        Color: =RGBA(255, 255, 255, 1)
        Fill: =RGBA(255, 0, 0, 1)
        Height: =28
        Size: =21
        Text: ="* Please fill in all mandatory fields"
        Visible: =errormessage
        Width: =453
        X: =92
        Y: =1033
        ZIndex: =9

    HtmlText1 As htmlViewer:
        Fill: =RGBA(255, 255, 255, 1)
        Height: =1136
        HtmlText: |-
            =/*Concatenate(
            "Please fix the below errors before continuing:
            <ul>
            ",
            gblErrorsList,"  
            </ul>")
            */
        Visible: =gblErrorLog > 0
        Width: =640
        ZIndex: =11

    Btn_add_details_4 As button:
        Fill: =RGBA(153, 153, 153, 1)
        Height: =70
        HoverFill: =ColorFade(RGBA(100, 118, 132, 1), -20%)
        OnSelect: =Set(gblErrorLog,0)
        Size: =24
        Text: ="Close"
        Visible: =gblErrorLog
        Width: =545
        X: =46
        Y: =1033
        ZIndex: =12

